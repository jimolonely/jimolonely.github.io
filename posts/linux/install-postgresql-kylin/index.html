<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>在麒麟linux上安装Postgresql12.5 | 孤独的寂寞</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="install postgresql 12.5 on kylin v10 linux"><meta name=generator content="Hugo 0.97.3"><meta name=robots content="index, follow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="在麒麟linux上安装Postgresql12.5"><meta property="og:description" content="install postgresql 12.5 on kylin v10 linux"><meta property="og:type" content="article"><meta property="og:url" content="https://jimolonely.github.io/posts/linux/install-postgresql-kylin/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-14T19:17:12+08:00"><meta property="article:modified_time" content="2022-04-14T19:17:12+08:00"><meta property="og:site_name" content="孤独的寂寞"><meta itemprop=name content="在麒麟linux上安装Postgresql12.5"><meta itemprop=description content="install postgresql 12.5 on kylin v10 linux"><meta itemprop=datePublished content="2022-04-14T19:17:12+08:00"><meta itemprop=dateModified content="2022-04-14T19:17:12+08:00"><meta itemprop=wordCount content="389"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="在麒麟linux上安装Postgresql12.5"><meta name=twitter:description content="install postgresql 12.5 on kylin v10 linux"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-111673440-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="ma0 avenir bg-transparent"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">孤独的寂寞</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ksa/ title="能力先行 页">能力先行</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/database/ title="Database 页">Database</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/algo/ title="算法之路 页">算法之路</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/bigdata/ title="大数据之路 页">大数据之路</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/cloud/ title="云计算之路 页">云计算之路</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="小怪 页">小怪</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/life/ title="谈人生 页">谈人生</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/arch/ title="架构 页">架构</a></li></ul><div class=ananke-socials><a href=https://github.com/jimolonely target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw9 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">LINUX</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">在麒麟linux上安装Postgresql12.5</h1><time class="f6 mv4 dib tracked" datetime=2022-04-14T19:17:12+08:00>2022-04-14</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>本文主要实践在麒麟V10版本上通过源码编译安装PostgreSQL12.5，因为是源码编译，所以对于其他版本也具有参考性。</p><h2 id=麒麟版本>麒麟版本</h2><p>V10</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ uname -a
</span></span><span style=display:flex><span>Linux kylin-v10-02 4.19.90-24.4.v2101.ky10.aarch64 <span style=color:#75715e>#1 SMP Mon May 24 14:45:37 CST 2021 aarch64 aarch64 aarch64 GNU/Linux</span></span></span></code></pre></div><h2 id=下载postgresql12-5源码>下载PostgreSQL12.5源码</h2><p>下载地址为官网：<a href=https://www.postgresql.org/ftp/source/v12.5/ target=_blank>https://www.postgresql.org/ftp/source/v12.5/</a></p><p>上传解压到服务器。</p><h2 id=编译源码过程>编译源码过程</h2><p><a href=http://www.postgres.cn/docs/12/install-procedure.html target=_blank>官方文档</a>.</p><p>运行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./configure</span></span></code></pre></div><p>得到如下报错：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>error: readline library not found</span></span></code></pre></div><p>需要安装<code>readline</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>yum install readline-devel -y</span></span></code></pre></div><p>然后再运行 <code>./configure</code></p><p>没有报错后，再运行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make</span></span></code></pre></div><p>编译完成后得到成功提示</p><p><img src=https://user-images.githubusercontent.com/17684996/163381674-d74bd018-f281-4fc2-9c3f-8ca1380761e1.png alt=image></p><p>然后开始安装, 运行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make install</span></span></code></pre></div><p>安装成功后可以看到</p><p><img src=https://user-images.githubusercontent.com/17684996/163381744-5fd5f7ee-5f07-4776-99d2-f702bfbe2c29.png alt=image></p><p>默认安装路径为 <code>/usr/local/pgsql</code>，我们需要将权限改为<code>postgres</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@kylin-v10-02 local<span style=color:#f92672>]</span><span style=color:#75715e># useradd postgres</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@kylin-v10-02 local<span style=color:#f92672>]</span><span style=color:#75715e># chown -R postgres:postgres /usr/local/pgsql/</span></span></span></code></pre></div><p><img src=https://user-images.githubusercontent.com/17684996/163381830-09b55013-d3ca-4831-bb51-b3ab2bf07f4e.png alt=image></p><h2 id=配置环境变量>配置环境变量</h2><p>安装完成后，还要做一些配置操作.</p><p><code>vim /etc/profile</code>加入下面的环境变量配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>/usr/local/pgsql/bin:$PATH
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LD_LIBRARY_PATH<span style=color:#f92672>=</span>/usr/local/pgsql/lib
</span></span><span style=display:flex><span>export LD_LIBRARY_PATH</span></span></code></pre></div><p>然后刷新配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>source /etc/profile</span></span></code></pre></div><h2 id=启动服务>启动服务</h2><p>在启动PG之前，需要准备一个数据目录，注意修改权限：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p /export/pgdata
</span></span><span style=display:flex><span>chown -R postgres:postgres /export/pgdata</span></span></code></pre></div><p>初始化数据库，注意，要切换到postgres用户</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># sudo su - postgres</span>
</span></span><span style=display:flex><span>initdb -D /export/pgdata/</span></span></code></pre></div><p>完整输出如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>The files belonging to this database system will be owned by user <span style=color:#e6db74>&#34;postgres&#34;</span>.
</span></span><span style=display:flex><span>This user must also own the server process.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The database cluster will be initialized with locale <span style=color:#e6db74>&#34;zh_CN.UTF-8&#34;</span>.
</span></span><span style=display:flex><span>The default database encoding has accordingly been set to <span style=color:#e6db74>&#34;UTF8&#34;</span>.
</span></span><span style=display:flex><span>initdb: could not find suitable text search configuration <span style=color:#66d9ef>for</span> locale <span style=color:#e6db74>&#34;zh_CN.UTF-8&#34;</span>
</span></span><span style=display:flex><span>The default text search configuration will be set to <span style=color:#e6db74>&#34;simple&#34;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Data page checksums are disabled.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fixing permissions on existing directory /export/pgdata ... ok
</span></span><span style=display:flex><span>creating subdirectories ... ok
</span></span><span style=display:flex><span>selecting dynamic shared memory implementation ... posix
</span></span><span style=display:flex><span>selecting default max_connections ... <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>selecting default shared_buffers ... 128MB
</span></span><span style=display:flex><span>selecting default time zone ... Asia/Shanghai
</span></span><span style=display:flex><span>creating configuration files ... ok
</span></span><span style=display:flex><span>running bootstrap script ... ok
</span></span><span style=display:flex><span>performing post-bootstrap initialization ... ok
</span></span><span style=display:flex><span>syncing data to disk ... ok
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>initdb: warning: enabling <span style=color:#e6db74>&#34;trust&#34;</span> authentication <span style=color:#66d9ef>for</span> local connections
</span></span><span style=display:flex><span>You can change this by editing pg_hba.conf or using the option -A, or
</span></span><span style=display:flex><span>--auth-local and --auth-host, the next time you run initdb.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Success. You can now start the database server using:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    pg_ctl -D /export/pgdata/ -l logfile start
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>启动PG</span></span></code></pre></div><p>那我们就启动服务：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>postgres@kylin-v10-02 ~<span style=color:#f92672>]</span>$ pg_ctl -D /export/pgdata/ -l logfile start
</span></span><span style=display:flex><span>waiting <span style=color:#66d9ef>for</span> server to start.... <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>server started</span></span></code></pre></div><h2 id=测试>测试</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>postgres@kylin-v10-02 ~<span style=color:#f92672>]</span>$ psql
</span></span><span style=display:flex><span>psql <span style=color:#f92672>(</span>12.5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#34;help&#34;</span> <span style=color:#66d9ef>for</span> help.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>postgres<span style=color:#f92672>=</span><span style=color:#75715e># \l</span>
</span></span><span style=display:flex><span>List of databases
</span></span><span style=display:flex><span>Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges   
</span></span><span style=display:flex><span>-----------+----------+----------+-------------+-------------+-----------------------
</span></span><span style=display:flex><span>postgres  | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 |
</span></span><span style=display:flex><span>template0 | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | <span style=color:#f92672>=</span>c/postgres          +
</span></span><span style=display:flex><span>|          |          |             |             | postgres<span style=color:#f92672>=</span>CTc/postgres
</span></span><span style=display:flex><span>template1 | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | <span style=color:#f92672>=</span>c/postgres          +
</span></span><span style=display:flex><span>|          |          |             |             | postgres<span style=color:#f92672>=</span>CTc/postgres
</span></span><span style=display:flex><span><span style=color:#f92672>(</span><span style=color:#ae81ff>3</span> rows<span style=color:#f92672>)</span></span></span></code></pre></div><p>测试ok，不过要提供给其他机器用，还需要一些监听和安全配置。</p><h2 id=修改密码>修改密码</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>postgres<span style=color:#f92672>=#</span> <span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>user</span> postgres password <span style=color:#e6db74>&#39;postgres&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>ROLE</span></span></span></code></pre></div><h2 id=修改监听地址>修改监听地址</h2><p>默认情况是在localhost上监听
<code>vim /export/pgdata/postgresql.conf</code> ，修改监听地址</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>listen_addresses <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;*&#39;</span></span></span></code></pre></div><p>还要允许密码访问，<code>vim /export/pgdata/pg_hba.conf</code>，在最后加入：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>host  all  all 0.0.0.0/0 md5</span></span></code></pre></div><p>然后重启服务</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pg_ctl -D /export/pgdata/ -l logfile restart</span></span></code></pre></div><p>下一篇，我们还会接着安装 <code>PostGIS</code>: <a href=/posts/linux/install-postgis-kylin/ target=_blank>在麒麟Linux安装Postgis</a> .</p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//jimolonely.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">这个posts中有</p><nav id=TableOfContents><ul><li><ul><li><a href=#麒麟版本>麒麟版本</a></li><li><a href=#下载postgresql12-5源码>下载PostgreSQL12.5源码</a></li><li><a href=#编译源码过程>编译源码过程</a></li><li><a href=#配置环境变量>配置环境变量</a></li><li><a href=#启动服务>启动服务</a></li><li><a href=#测试>测试</a></li><li><a href=#修改密码>修改密码</a></li><li><a href=#修改监听地址>修改监听地址</a></li></ul></li></ul></nav></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://jimolonely.github.io/>&copy; 孤独的寂寞 2022</a><div><div class=ananke-socials><a href=https://github.com/jimolonely target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>